{"name":"日志","slug":"日志","count":1,"postlist":[{"title":"Log4j组件Appender发消息","slug":"Log4j组件Appender发消息","date":"2021-07-30T03:51:55.940Z","updated":"2021-08-05T09:09:55.744Z","comments":true,"path":"api/articles/Log4j组件Appender发消息.json","excerpt":"","keywords":null,"cover":null,"content":"<h1 id=\"自定义MailAppender\"><a href=\"#自定义MailAppender\" class=\"headerlink\" title=\"自定义MailAppender\"></a>自定义MailAppender</h1><ol start=\"0\">\n<li>引入Log4j2的相关依赖</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.6.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.6.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>MailAppender的实现：</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 自定义Appender，实现把日志内容发送到邮箱。</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"comment\">// Plugin注解将一个类声明为log4j的插件</span></span><br><span class=\"line\"><span class=\"meta\">@Plugin(name=&quot;mail&quot;, category = &quot;core&quot;, elementType = &quot;appender&quot;, printObject = true)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MailAppender</span> <span class=\"keyword\">extends</span> <span class=\"title\">AbstractAppender</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 需要实现构造方法，直接用父类的</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"title\">MailAppender</span><span class=\"params\">(String name, Filter filter, Layout&lt;? extends Serializable&gt; layout)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(name, filter, layout);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MailAppender</span><span class=\"params\">(String name, Filter filter, Layout&lt;? extends Serializable&gt; layout, <span class=\"keyword\">boolean</span> ignoreExceptions)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(name, filter, layout, ignoreExceptions);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">append</span><span class=\"params\">(LogEvent logEvent)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">byte</span>[] bytes = getLayout().toByteArray(logEvent);</span><br><span class=\"line\">        String text = <span class=\"keyword\">new</span> String(bytes);</span><br><span class=\"line\">        MailUtil.sendMail(text, <span class=\"string\">&quot;This a Mail from log&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">\t\t<span class=\"comment\">//获取配置文件中的内容</span></span><br><span class=\"line\">    <span class=\"meta\">@PluginFactory</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> MailAppender <span class=\"title\">createAppender</span><span class=\"params\">(<span class=\"meta\">@PluginAttribute(&quot;name&quot;)</span>String name,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                                              <span class=\"meta\">@PluginElement(&quot;Filters&quot;)</span>Filter filter,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                                              <span class=\"meta\">@PluginElement(&quot;Layout&quot;)</span>Layout layout)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(name == <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">            LOGGER.error(<span class=\"string\">&quot;No name provided for MailAppender&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(layout == <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">            layout = PatternLayout.createDefaultLayout();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> MailAppender(name, filter, layout);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>Log4j2.xml文件配置：</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- packages指定程序启动时需要扫描的包，以发现自定义的Appender --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Configuration</span> <span class=\"attr\">packages</span>=<span class=\"string\">&quot;com.yy.appender&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Appenders</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">mail</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;mail&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">PatternLayout</span> <span class=\"attr\">pattern</span>=<span class=\"string\">&quot;%d&#123;HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">mail</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Appenders</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Loggers</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">Logger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;mailLogger&quot;</span>&gt;</span></span><br><span class=\"line\">        \t<span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;mail&quot;</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">Logger</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">Root</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;info&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Root</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Loggers</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>测试</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LogTest</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Logger log = LogManager.getLogger(<span class=\"string\">&quot;mailLogger&quot;</span>);</span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;这是一封info级别的日志！&quot;</span>);</span><br><span class=\"line\">        log.error(<span class=\"string\">&quot;这是一封error级别的日志！&quot;</span>);</span><br><span class=\"line\">        log.debug(<span class=\"string\">&quot;这是一封debug级别的日志！&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"发邮件\"><a href=\"#发邮件\" class=\"headerlink\" title=\"发邮件\"></a>发邮件</h1><ul>\n<li><p><strong>Message</strong>：创建和解析邮件，表示一封电子邮件，包含邮件收件人，发件人，邮件内容和主题等。</p>\n</li>\n<li><p><strong>Transport</strong>：发送邮件，连接服务器、发送Message、关闭连接。</p>\n</li>\n<li><p><strong>Session</strong>：定义整个应用程序所需的环境信息，以及收集客户端与邮件服务器建立网络连接的会话信息，例如邮件服务器的主机名、端口号、采用的邮件发送和接收协议等。</p>\n</li>\n</ul>\n<ol>\n<li>引入邮件依赖：</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.sun.mail<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>javax.mail<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.5.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.mail<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>javax.mail-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.5.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>发送邮件代码</li>\n</ol>\n<p>（1）简单文本邮件代码如下：</p>\n<p><a href=\"https://www.cnblogs.com/ysocean/p/7666061.html\">邮件实现详解（四）——JavaMail 发送（带图片和附件）和接收邮件</a></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.io.ObjectInputStream.GetField;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Date;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Properties;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.mail.Address;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.mail.Message;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.mail.MessagingException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.mail.Session;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.mail.Transport;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.mail.internet.AddressException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.mail.internet.InternetAddress;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.mail.internet.MimeMessage;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.swing.text.html.MinimalHTMLWriter;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SendMailText</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//发件人地址</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String senderAddress =<span class=\"string\">&quot;xxx@163.com&quot;</span>;</span><br><span class=\"line\">    <span class=\"comment\">//收件人地址</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String recipientAddress =<span class=\"string\">&quot;xxx@qq.com&quot;</span>;</span><br><span class=\"line\">    <span class=\"comment\">//发件人账户名</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String senderAccount =<span class=\"string\">&quot;xxx&quot;</span>;</span><br><span class=\"line\">    <span class=\"comment\">//发件人账户密码</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String senderPassword =<span class=\"string\">&quot;xxx&quot;</span>;</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span><span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//1、连接邮件服务器的参数配置</span></span><br><span class=\"line\">        Properties props =<span class=\"keyword\">new</span> Properties();</span><br><span class=\"line\">        <span class=\"comment\">//设置用户的认证方式</span></span><br><span class=\"line\">        props.setProperty(<span class=\"string\">&quot;mail.smtp.auth&quot;</span>,<span class=\"string\">&quot;true&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//设置传输协议</span></span><br><span class=\"line\">        props.setProperty(<span class=\"string\">&quot;mail.transport.protocol&quot;</span>,<span class=\"string\">&quot;smtp&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//设置发件人的SMTP服务器地址</span></span><br><span class=\"line\">        props.setProperty(<span class=\"string\">&quot;mail.smtp.host&quot;</span>,<span class=\"string\">&quot;smtp.163.com&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//2、创建定义整个应用程序所需的环境信息的 Session 对象</span></span><br><span class=\"line\">        Session session = Session.getInstance(props);</span><br><span class=\"line\">        <span class=\"comment\">//设置调试信息在控制台打印出来</span></span><br><span class=\"line\">        session.setDebug(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">        <span class=\"comment\">//3、创建邮件的实例对象</span></span><br><span class=\"line\">        Message msg = getMimeMessage(session);</span><br><span class=\"line\">        <span class=\"comment\">//4、根据session对象获取邮件传输对象Transport</span></span><br><span class=\"line\">        Transport transport = session.getTransport();</span><br><span class=\"line\">        <span class=\"comment\">//设置发件人的账户名和密码</span></span><br><span class=\"line\">        transport.connect(senderAccount, senderPassword);</span><br><span class=\"line\">        <span class=\"comment\">//发送邮件，并发送到所有收件人地址，message.getAllRecipients() 获取到的是在创建邮件对象时添加的所有收件人, 抄送人, 密送人</span></span><br><span class=\"line\">        transport.sendMessage(msg,msg.getAllRecipients());</span><br><span class=\"line\">         </span><br><span class=\"line\">        <span class=\"comment\">//如果只想发送给指定的人，可以如下写法</span></span><br><span class=\"line\">        <span class=\"comment\">//transport.sendMessage(msg, new Address[]&#123;new InternetAddress(&quot;xxx@qq.com&quot;)&#125;);</span></span><br><span class=\"line\">         </span><br><span class=\"line\">        <span class=\"comment\">//5、关闭邮件连接</span></span><br><span class=\"line\">        transport.close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获得创建一封邮件的实例对象</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> session</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> MessagingException</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> AddressException</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> MimeMessage <span class=\"title\">getMimeMessage</span><span class=\"params\">(Session session)</span><span class=\"keyword\">throws</span> Exception</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//创建一封邮件的实例对象</span></span><br><span class=\"line\">        MimeMessage msg =<span class=\"keyword\">new</span> MimeMessage(session);</span><br><span class=\"line\">        <span class=\"comment\">//设置发件人地址</span></span><br><span class=\"line\">        msg.setFrom(<span class=\"keyword\">new</span> InternetAddress(senderAddress));</span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * 设置收件人地址（可以增加多个收件人、抄送、密送），即下面这一行代码书写多行</span></span><br><span class=\"line\"><span class=\"comment\">         * MimeMessage.RecipientType.TO:发送</span></span><br><span class=\"line\"><span class=\"comment\">         * MimeMessage.RecipientType.CC：抄送</span></span><br><span class=\"line\"><span class=\"comment\">         * MimeMessage.RecipientType.BCC：密送</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        msg.setRecipient(MimeMessage.RecipientType.TO,<span class=\"keyword\">new</span> InternetAddress(recipientAddress));</span><br><span class=\"line\">        <span class=\"comment\">//设置邮件主题</span></span><br><span class=\"line\">        msg.setSubject(<span class=\"string\">&quot;邮件主题&quot;</span>,<span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//设置邮件正文</span></span><br><span class=\"line\">        msg.setContent(<span class=\"string\">&quot;简单的纯文本邮件！&quot;</span>,<span class=\"string\">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//设置邮件的发送时间,默认立即发送</span></span><br><span class=\"line\">        msg.setSentDate(<span class=\"keyword\">new</span> Date());</span><br><span class=\"line\">         </span><br><span class=\"line\">        <span class=\"keyword\">return</span> msg;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>（2）Authenticator认证结合Transport的静态send方法发送邮件，代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">sendMail</span><span class=\"params\">(String text, String subject)</span></span>&#123;</span><br><span class=\"line\">  \t<span class=\"keyword\">final</span> Properties prop = <span class=\"keyword\">new</span> Properties();</span><br><span class=\"line\">  \t<span class=\"comment\">// 读取配置文件</span></span><br><span class=\"line\">  \tInputStream in = MailUtil.class.getClassLoader().getResourceAsStream(<span class=\"string\">&quot;mail.properties&quot;</span>);</span><br><span class=\"line\">  \t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    \t\tprop.load(in);</span><br><span class=\"line\">    \t\tin.close();</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 开启认证</span></span><br><span class=\"line\">    \t\tprop.setProperty(<span class=\"string\">&quot;mail.smtp.auth&quot;</span>, <span class=\"string\">&quot;true&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 邮件传输协议</span></span><br><span class=\"line\">    \t\tprop.setProperty(<span class=\"string\">&quot;mail.transport.protocol&quot;</span>, <span class=\"string\">&quot;smtp&quot;</span>);</span><br><span class=\"line\">      \t<span class=\"comment\">// 服务器地址</span></span><br><span class=\"line\">    \t\tprop.setProperty(<span class=\"string\">&quot;mail.host&quot;</span>, <span class=\"string\">&quot;smtp.qq.com&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    \t\t<span class=\"comment\">// 邮箱认证</span></span><br><span class=\"line\">    \t\tAuthenticator auth = <span class=\"keyword\">new</span> Authenticator() &#123;</span><br><span class=\"line\">      \t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">      \t\t\t<span class=\"function\"><span class=\"keyword\">protected</span> PasswordAuthentication <span class=\"title\">getPasswordAuthentication</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        \t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> PasswordAuthentication(prop.getProperty(<span class=\"string\">&quot;mailFrom&quot;</span>), prop.getProperty(<span class=\"string\">&quot;mailPassword&quot;</span>));</span><br><span class=\"line\">      \t\t\t&#125;</span><br><span class=\"line\">    \t\t&#125;;</span><br><span class=\"line\">    \t\t<span class=\"comment\">// 使用邮件信息和授权信息创建会话</span></span><br><span class=\"line\">    \t\tSession mailSession = Session.getInstance(prop, auth);</span><br><span class=\"line\">    \t\t<span class=\"comment\">// 创建邮件消息</span></span><br><span class=\"line\">    \t\tMimeMessage message = <span class=\"keyword\">new</span> MimeMessage(mailSession);</span><br><span class=\"line\">    \t\t<span class=\"comment\">// 设置发件人</span></span><br><span class=\"line\">    \t\tmessage.setFrom(<span class=\"keyword\">new</span> InternetAddress(prop.getProperty(<span class=\"string\">&quot;mailFrom&quot;</span>)));</span><br><span class=\"line\"></span><br><span class=\"line\">    \t\t<span class=\"comment\">// 设置收件人</span></span><br><span class=\"line\">    \t\tmessage.setRecipient(Message.RecipientType.TO, <span class=\"keyword\">new</span> InternetAddress(prop.getProperty(<span class=\"string\">&quot;mailTo&quot;</span>)));</span><br><span class=\"line\"></span><br><span class=\"line\">    \t\t<span class=\"comment\">// 设置邮件内容</span></span><br><span class=\"line\">    \t\tmessage.setSubject(subject);</span><br><span class=\"line\">    \t\tmessage.setContent(text, <span class=\"string\">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    \t\t<span class=\"comment\">// 发送邮件</span></span><br><span class=\"line\">    \t\tTransport.send(message);</span><br><span class=\"line\"></span><br><span class=\"line\">    \t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">  \t&#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">    \t\te.printStackTrace();</span><br><span class=\"line\">  \t&#125; <span class=\"keyword\">catch</span> (AddressException e) &#123;</span><br><span class=\"line\">    \t\te.printStackTrace();</span><br><span class=\"line\">  \t&#125; <span class=\"keyword\">catch</span> (MessagingException e) &#123;</span><br><span class=\"line\">    \t\te.printStackTrace();</span><br><span class=\"line\">  \t&#125;</span><br><span class=\"line\">  \t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>mail.properties文件：</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 发件人邮箱</span></span><br><span class=\"line\"><span class=\"attr\">mailFrom</span>=<span class=\"string\">xxx@qq.com</span></span><br><span class=\"line\"><span class=\"comment\"># 发件人邮箱密码</span></span><br><span class=\"line\"><span class=\"attr\">mailPassword</span>=<span class=\"string\">xxxxx</span></span><br><span class=\"line\"><span class=\"comment\"># 收件人</span></span><br><span class=\"line\"><span class=\"attr\">mailTo</span>=<span class=\"string\">yyy@163.com</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"HttpClient\"><a href=\"#HttpClient\" class=\"headerlink\" title=\"HttpClient\"></a>HttpClient</h1><p><a href=\"https://blog.csdn.net/xcxzzx01/article/details/108299813\">(新版）通过java程序，给微信发送消息</a></p>\n<p><a href=\"https://blog.csdn.net/justry_deng/article/details/81042379\">HttpClient详细使用示例</a></p>\n<p>使用HttpClient发送请求、接收响应，一般需要如下几步:</p>\n<ol>\n<li>创建HttpClient对象。</li>\n<li>创建请求方法的实例，并指定请求URL。如果需要发送GET请求，创建HttpGet对象；如果需要发送POST请求，创建HttpPost对象。</li>\n<li>如果需要发送请求参数，可调用HttpGet、HttpPost共同的setParams(HetpParams params)方法来添加请求参数；对于HttpPost对象而言，也可调用setEntity(HttpEntity entity)方法来设置请求参数。</li>\n<li>调用HttpClient对象的execute(HttpUriRequest request)发送请求，该方法返回一个HttpResponse。</li>\n<li>调用HttpResponse的getAllHeaders()、getHeaders(String name)等方法可获取服务器的响应头；调用HttpResponse的getEntity()方法可获取HttpEntity对象，该对象包装了服务器的响应内容。程序可通过该对象获取服务器的响应内容。</li>\n<li>释放连接。无论执行方法是否成功，都必须释放连接</li>\n</ol>\n","text":"自定义MailAppender引入Log4j2的相关依赖1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>&lt;dependency&gt;<br>  &lt;groupId&gt;org.apache.logging.log","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"日志","slug":"日志","count":1,"path":"api/tags/日志.json"}]}]}